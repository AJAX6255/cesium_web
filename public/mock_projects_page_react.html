<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Mock Cesium Projects Tab</title>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.0.0-alpha/css/bootstrap.css" />
        <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" />
        <link rel="stylesheet" href="css/base.css" />
        <script src="https://fb.me/react-with-addons-15.0.1.js"></script>
        <script src="https://fb.me/react-dom-15.0.1.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.6.16/browser.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.2/jquery.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.0.0-alpha/js/bootstrap.min.js"></script>
    </head>
    <body>
        <div id="content"></div>

        <script type="text/babel">

         var ReactCSSTransitionGroup = React.addons.CSSTransitionGroup;

         var MainContent = React.createClass({
             getInitialState: function() {
                 return {
                     forms: {
                         newProject: {
                             "Project Name": "",
                             "Description/notes": "",
                             "Additional Authorized Users": ""
                         },
                         newDataset: {
                             "Dataset Name": ""
                         }
                     },
                     projectsList: [{"name": "", "created": "", "id": ""}]
                 };
             },
             componentDidMount: function() {
                 this.loadState();
             },
             loadState: function() {
                 $.ajax({
                     url: "/get_state",
                     dataType: "json",
                     cache: false,
                     success: function(data) {
                         this.setState({projectsList: data.projectsList,
                                        datasetsList: data.datasetsList,
                                        modelsList: data.modelsList,
                                        predictionsList: data.predictionsList
                         });
                     }.bind(this),
                     error: function(xhr, status, err) {
                         console.error("/get_state", status, err.toString(),
                                       xhr.repsonseText);
                     }.bind(this)
                 });
             },
             handleNewProjectSubmit: function(e) {
                 e.preventDefault();
                 $.ajax({
                     url: "/newProject",
                     dataType: "json",
                     type: "POST",
                     data: this.state.forms.newProject,
                     success: function(data) {
                         var form_state = this.state.forms;
                         form_state.newProject = this.getInitialState().forms.newProject;
                         this.setState({projectsList: data, forms: form_state});
                     }.bind(this),
                     error: function(xhr, status, err) {
                         console.error("/newProject", status, err.toString(),
                                       xhr.repsonseText);
                     }.bind(this)
                 });
             },
             handleEditProject: function(projectID, e) {
                 // TODO: Open form in Dialog
             },
             handleDeleteProject: function(projectID, e) {
                 $.ajax({
                     url: "/deleteProject",
                     dataType: "json",
                     type: "POST",
                     data: {"project_key": projectID},
                     success: function(data) {
                         this.setState({projectsList: data});
                     }.bind(this),
                     error: function(xhr, status, err) {
                         console.error("/deleteProject", status, err.toString(),
                                       xhr.repsonseText);
                     }.bind(this)
                 });
             },
             handleInputChange: function(inputName, inputTypeTag, formName, e) {
                 var form_state = this.state.forms;
                 form_state[formName][inputName] = e.target.value;
                 this.setState({forms: form_state});
             },
             render: function() {
                 return (
                     <div className="mainContent">
                         <ProjectsTabContent
                             getInitialState={this.getInitialState}
                             loadProjects={this.loadProjects}
                             handleNewProjectSubmit={this.handleNewProjectSubmit}
                             handleEditProject={this.handleEditProject}
                             handleDeleteProject={this.handleDeleteProject}
                             handleInputChange={this.handleInputChange}
                             formFields={this.state.forms.newProject}
                             projectsList={this.state.projectsList}
                         />
                     </div>
                 );
             }
         });

         var ProjectsTabContent = React.createClass({
             render: function() {
                 return (
                     <div className="projectsTabContent">
                         <NewProjectForm
                             handleInputChange={this.props.handleInputChange}
                             formFields={this.props.formFields}
                             handleSubmit={this.props.handleNewProjectSubmit}
                         />
                         <ProjectList
                             projectsList={this.props.projectsList}
                             editProject={this.props.handleEditProject}
                             deleteProject={this.props.handleDeleteProject}
                         />
                     </div>
                 );
             }
         });

         var NewProjectForm = React.createClass({
             render: function() {
                 return (
                     <div className="formTableDiv">
                         <FormTitleRow formTitle="Create a new project"
                         />
                         <FormInputRow inputName="Project Name"
                                       inputTag="input"
                                       inputType="text"
                                       form="newProject"
                                       value={this.props.formFields["Project Name"]}
                                       handleInputChange={this.props.handleInputChange}
                         />
                         <FormInputRow inputName="Description/notes"
                                       inputTag="textarea"
                                       form="newProject"
                                       value={this.props.formFields["Description/notes"]}
                                       handleInputChange={this.props.handleInputChange}
                         />
                         <FormInputRow inputName="Additional Authorized Users"
                                       inputTag="textarea"
                                       form="newProject"
                                       value={this.props.formFields["Additional Authorized Users"]}
                                       handleInputChange={this.props.handleInputChange}
                         />
                         <div className="submitButtonDiv" style={{marginTop: 15}}>
                             <input type="submit"
                                    onClick={this.props.handleSubmit}
                                    value="Submit"
                                    className="submitButton"
                             />
                         </div>
                     </div>
                 );
             }
         });

         var ProjectList = React.createClass({
             render: function() {
                 var projectNodes = this.props.projectsList.map(function(project) {
                     return (
                         <ProjectListRow
                             project={project}
                             key={project.id}
                             editProject={this.props.editProject}
                             deleteProject={this.props.deleteProject}
                         />
                     );
                 }.bind(this));
                 return (
                     <div className="projectListDiv" style={{marginTop: 40}}>
                         <h3>Existing Projects</h3>
                         <div style={{width: 320, float: 'left'}}>
                             <b>Name</b>
                         </div>
                         <div style={{marginLeft: 20, width: 320, float: 'left'}}>
                             <b>Date Created</b>
                         </div>
                         <div style={{marginLeft: 710}}>
                             <b>Edit/Delete Project</b>
                         </div>
                         <div>
                             <ReactCSSTransitionGroup
                                 transitionName="projectsListItems"
                                 transitionEnterTimeout={200}
                                 transitionLeaveTimeout={200}>
                                 {projectNodes}
                             </ReactCSSTransitionGroup>
                         </div>
                     </div>
                 );
             }
         });

         var ProjectListRow = React.createClass({
             render: function() {
                 return (
                     <div>
                         <div style={{width: 320, float: 'left'}}>
                             {this.props.project.name}
                         </div>
                         <div style={{marginLeft: 20, width: 320, float: 'left'}}>
                             {this.props.project.created}
                         </div>
                         <div style={{marginLeft: 710}}>
                             <a href="#" onClick={this.props.editProject.bind(null, this.props.project.id)}>
                                 <span className="glyphicon glyphicon-edit"
                                       title="Edit">
                                 </span>
                             </a>
                             <a href="#" onClick={this.props.deleteProject.bind(null, this.props.project.id)}>
                                 <span style={{marginLeft: 10}}
                                       className="glyphicon glyphicon-trash"
                                       title="Delete">
                                 </span>
                             </a>
                         </div>
                     </div>
                 );
             }
         });

         var FormInputRow = React.createClass({
             render: function() {
                 return (
                     <div className="formInputRow">
                         <div className="formInputTitle"
                              style={{width: 320, float: 'left', marginTop: 5}}>
                             {this.props.inputName}
                         </div>
                         <div className="formInputField"
                              style={{marginLeft: 340, marginTop: 5}}>
                             <this.props.inputTag
                                 type={this.props.inputType}
                                 value={this.props.value}
                                 onChange={this.props.handleInputChange.bind(
                                          null, this.props.inputName,
                                          this.props.inputTypeTag,
                                          this.props.form)}
                             />
                         </div>
                     </div>
                 );
             }
         });

         var FormTitleRow = React.createClass({
             render: function() {
                 return (
                     <div className="formTitleDiv" style={{marginTop: 30}}>
                         <h3>
                             {this.props.formTitle}
                         </h3>
                     </div>
                 );
             }
         });


         ReactDOM.render(
             <MainContent />,
             document.getElementById('content')
         );

        </script>

    </body>
</html>
